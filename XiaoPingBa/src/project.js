require=function c(l,n,a){function r(e,t){if(!n[e]){if(!l[e]){var s="function"==typeof require&&require;if(!t&&s)return s(e,!0);if(h)return h(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var o=n[e]={exports:{}};l[e][0].call(o.exports,function(t){return r(l[e][1][t]||t)},o,o.exports,c,l,n,a)}return n[e].exports}for(var h="function"==typeof require&&require,t=0;t<a.length;t++)r(a[t]);return r}({CellModel:[function(t,e,s){"use strict";cc._RF.push(e,"dae88GCevBMaK7lQqhume8G","CellModel"),Object.defineProperty(s,"__esModule",{value:!0}),s.default=o;var i=t("./ConstValue");function o(){this.type=null,this.status=i.CELL_STATUS.COMMON,this.x=1,this.y=1,this.startX=1,this.startY=1,this.cmd=[],this.isDeath=!1,this.objecCount=Math.floor(1e3*Math.random())}o.prototype.init=function(t){this.type=t},o.prototype.isEmpty=function(){return this.type==i.CELL_TYPE.EMPTY},o.prototype.setEmpty=function(){this.type=i.CELL_TYPE.EMPTY},o.prototype.setXY=function(t,e){this.x=t,this.y=e},o.prototype.setStartXY=function(t,e){this.startX=t,this.startY=e},o.prototype.setStatus=function(t){this.status=t},o.prototype.moveToAndBack=function(t){var e=cc.p(this.x,this.y);this.cmd.push({action:"moveTo",keepTime:i.ANITIME.TOUCH_MOVE,playTime:0,pos:t}),this.cmd.push({action:"moveTo",keepTime:i.ANITIME.TOUCH_MOVE,playTime:i.ANITIME.TOUCH_MOVE,pos:e})},o.prototype.moveTo=function(t,e){cc.p(this.x,this.y);this.cmd.push({action:"moveTo",keepTime:i.ANITIME.TOUCH_MOVE,playTime:e,pos:t}),this.x=t.x,this.y=t.y},o.prototype.toDie=function(t){this.cmd.push({action:"toDie",playTime:t,keepTime:i.ANITIME.DIE}),this.isDeath=!0},o.prototype.toShake=function(t){this.cmd.push({action:"toShake",playTime:t,keepTime:i.ANITIME.DIE_SHAKE})},o.prototype.setVisible=function(t,e){this.cmd.push({action:"setVisible",playTime:t,keepTime:0,isVisible:e})},o.prototype.moveToAndDie=function(t){},o.prototype.isBird=function(){return this.type==i.CELL_TYPE.G},e.exports=s.default,cc._RF.pop()},{"./ConstValue":"ConstValue"}],CellView:[function(t,e,s){"use strict";cc._RF.push(e,"fbf19Cx4ptFV62UZ7+qJJpQ","CellView");var p=t("../Model/ConstValue");cc.Class({extends:cc.Component,properties:{defaultFrame:{default:null,type:cc.SpriteFrame},score_lable:{default:null,type:cc.Label},score:0},onLoad:function(){this.isSelect=!1},initWithModel:function(t){var e=(this.model=t).startX,s=t.startY;this.node.x=p.CELL_WIDTH*(e-.5),this.node.y=p.CELL_HEIGHT*(s-.5);var i=this.node.getComponent(cc.Animation);t.status==p.CELL_STATUS.COMMON?i.stop():i.play(t.status)},updateView:function(){var e=this,s=this.model.cmd;if(!(s.length<=0)){var t,i=[],o=0;for(var c in s){if(s[c].playTime>o){var l=cc.delayTime(s[c].playTime-o);i.push(l)}if("moveTo"==s[c].action){var n=(s[c].pos.x-.5)*p.CELL_WIDTH,a=(s[c].pos.y-.5)*p.CELL_HEIGHT,r=cc.moveTo(p.ANITIME.TOUCH_MOVE,cc.p(n,a));i.push(r)}else if("toDie"==s[c].action){if(this.status==p.CELL_STATUS.BIRD)this.node.getComponent(cc.Animation).play("effect"),i.push(cc.delayTime(p.ANITIME.BOMB_BIRD_DELAY));var h=cc.callFunc(function(){this.node.destroy()},this);i.push(h)}else if("setVisible"==s[c].action)(function(){var t=s[c].isVisible;i.push(cc.callFunc(function(){this.node.opacity=t?255:0},e))})();else if("toShake"==s[c].action){var u=cc.rotateBy(.4,60);i.push(u)}o=s[c].playTime+s[c].keepTime}if(1==i.length)this.node.runAction(i[0]);else this.node.runAction((t=cc).sequence.apply(t,i))}},setSelect:function(t){var e=this.node.getComponent(cc.Animation),s=this.node.getChildByName("select");0==t&&this.isSelect&&this.model.status==p.CELL_STATUS.COMMON?(e.stop(),this.node.getComponent(cc.Sprite).spriteFrame=this.defaultFrame):t&&this.model.status==p.CELL_STATUS.COMMON?e.play(p.CELL_STATUS.CLICK):t&&this.model.status==p.CELL_STATUS.BIRD&&e.play(p.CELL_STATUS.CLICK),s.active=t,this.isSelect=t}}),cc._RF.pop()},{"../Model/ConstValue":"ConstValue"}],ConstValue:[function(t,e,s){"use strict";cc._RF.push(e,"f9088esGbNBtJmNaJsz0Gq4","ConstValue"),Object.defineProperty(s,"__esModule",{value:!0});s.CELL_TYPE={EMPTY:0,A:1,B:2,C:3,D:4,E:5,F:6,BIRD:7},s.CELL_BASENUM=6,s.CELL_STATUS={COMMON:0,CLICK:"click",LINE:"line",COLUMN:"column",WRAP:"wrap",BIRD:"bird"};var i=s.GRID_WIDTH=6,o=s.GRID_HEIGHT=6,c=s.CELL_WIDTH=75,l=s.CELL_HEIGHT=75;s.GRID_PIXEL_WIDTH=i*c,s.GRID_PIXEL_HEIGHT=o*l,s.ANITIME={TOUCH_MOVE:.3,DIE:.2,DOWN:.5,BOMB_DELAY:.3,BOMB_BIRD_DELAY:.7,DIE_SHAKE:.4};cc._RF.pop()},{}],EffectLayer:[function(t,e,s){"use strict";cc._RF.push(e,"0e925myn0dIjqdao1TpipF9","EffectLayer");var i=t("../Model/ConstValue");cc.Class({extends:cc.Component,properties:{bombWhite:{default:null,type:cc.Prefab},crushEffect:{default:null,type:cc.Prefab}},onLoad:function(){},playEffects:function(t){!t||t.length<=0||t.forEach(function(s){var t=cc.delayTime(s.playTime),e=cc.callFunc(function(){var t=null,e=null;"crush"==s.action?(e=(t=cc.instantiate(this.crushEffect)).getComponent(cc.Animation)).play("effect"):"rowBomb"==s.action?(e=(t=cc.instantiate(this.bombWhite)).getComponent(cc.Animation)).play("effect_line"):"colBomb"==s.action&&(e=(t=cc.instantiate(this.bombWhite)).getComponent(cc.Animation)).play("effect_col"),t.x=i.CELL_WIDTH*(s.pos.x-.5),t.y=i.CELL_WIDTH*(s.pos.y-.5),t.parent=this.node,e.on("finished",function(){t.destroy()},this)},this);this.node.runAction(cc.sequence(t,e))},this)}}),cc._RF.pop()},{"../Model/ConstValue":"ConstValue"}],EndScene:[function(t,e,s){"use strict";cc._RF.push(e,"cc1c1w6GUtItqKOVjrTjBti","EndScene"),cc.Class({extends:cc.Component,properties:{restart_btn:{default:null,type:cc.Node}},onLoad:function(){cc.director.preloadScene("Start"),this.restart_btn.on("touchstart",function(){cc.director.loadScene("Start")})},start:function(){}}),cc._RF.pop()},{}],GameController:[function(t,e,s){"use strict";cc._RF.push(e,"5ac64Iq16lBqrHZ0246FRcZ","GameController");var i,o=t("../Model/GameModel"),c=(i=o)&&i.__esModule?i:{default:i};cc.Class({extends:cc.Component,properties:{grid:{default:null,type:cc.Node},Time_Label:{default:null,type:cc.Label},time:180,Score_label:{default:null,type:cc.Label},score:0,chushi:0},onLoad:function(){this.gameModel=new c.default,this.gameModel.init(5);var t=this.grid.getComponent("GridView");t.setController(this),t.initWithCellModels(this.gameModel.getCells()),this.schedule(function(){this.time--,this.Time_Label.string="Time:"+this.time,this.time<=0&&cc.director.loadScene("End")},1)},selectCell:function(t){return this.gameModel.selectCell(t)},cleanCmd:function(){this.gameModel.cleanCmd()},update:function(){this.score=this.gameModel.setScore(),this.Score_label.string="当前得分:"+this.score}}),cc._RF.pop()},{"../Model/GameModel":"GameModel"}],GameModel:[function(t,e,s){"use strict";cc._RF.push(e,"cc442HaMlBE/ZKi7W/YUKwd","GameModel"),Object.defineProperty(s,"__esModule",{value:!0}),s.default=c;var i,o=t("./CellModel"),l=(i=o)&&i.__esModule?i:{default:i},d=t("./ConstValue");t("GameController");function c(){this.cells=null,this.cellBgs=null,this.lastPos=cc.p(-1,-1),this.cellTypeNum=5,this.cellCreateType=[]}c.prototype.init=function(t){this.cells=[],this.setCellTypeNum(t||this.cellTypeNum);for(var e=1;e<=d.GRID_WIDTH;e++){this.cells[e]=[];for(var s=1;s<=d.GRID_HEIGHT;s++)this.cells[e][s]=new l.default}for(e=1;e<=d.GRID_WIDTH;e++)for(s=1;s<=d.GRID_HEIGHT;s++)for(var i=!0;i;){i=!1,this.cells[e][s].init(this.getRandomCellType()),2<this.checkPoint(s,e)[0].length&&(i=!0),this.cells[e][s].setXY(s,e),this.cells[e][s].setStartXY(s,e)}},c.prototype.initWithData=function(t){},c.prototype.checkPoint=function(t,e){var s=function(t,e,s){var i=[],o=[];o[t+e*d.GRID_HEIGHT]=!0,i.push(cc.p(t,e));for(var c=0;c<i.length;){var l=i[c],n=this.cells[l.y][l.x];if(c++,n)for(var a=0;a<s.length;a++){var r=l.x+s[a].x,h=l.y+s[a].y;r<1||r>d.GRID_WIDTH||h<1||h>d.GRID_HEIGHT||o[r+h*d.GRID_HEIGHT]||!this.cells[h][r]||n.type==this.cells[h][r].type&&(o[r+h*d.GRID_HEIGHT]=!0,i.push(cc.p(r,h)))}}return i},i=s.call(this,t,e,[cc.p(1,0),cc.p(-1,0)]),o=s.call(this,t,e,[cc.p(0,-1),cc.p(0,1)]),c=[],l="";if(5<=i.length||5<=o.length?l=d.CELL_STATUS.BIRD:3<=i.length&&3<=o.length?l=d.CELL_STATUS.WRAP:4<=i.length?l=d.CELL_STATUS.LINE:4<=o.length&&(l=d.CELL_STATUS.COLUMN),3<=i.length&&(c=i),3<=o.length){var n=c.concat();o.forEach(function(e){var s=!1;n.forEach(function(t){e.x==t.x&&e.y==t.y&&(s=!0)},this),s||c.push(e)},this)}return[c,l,this.cells[e][t].type]},c.prototype.printInfo=function(){for(var t=1;t<=d.GRID_WIDTH;t++){for(var e="",s=1;s<=d.GRID_HEIGHT;s++)e+=this.cells[t][s].type+" ";console.log(e)}},c.prototype.getCells=function(){return this.cells},c.prototype.selectCell=function(t){this.changeModels=[],this.effectsQueue=[];var e=this.lastPos;if(1!=Math.abs(t.x-e.x)+Math.abs(t.y-e.y))return this.lastPos=t,[[],[]];this.exchangeCell(e,t);var s=this.checkPoint(t.x,t.y)[0],i=this.checkPoint(e.x,e.y)[0];this.curTime=0,this.pushToChangeModels(this.cells[t.y][t.x]),this.pushToChangeModels(this.cells[e.y][e.x]);var o=this.cells[t.y][t.x].status!=d.CELL_STATUS.COMMON&&this.cells[e.y][e.x].status!=d.CELL_STATUS.COMMON||this.cells[t.y][t.x].status==d.CELL_STATUS.BIRD||this.cells[e.y][e.x].status==d.CELL_STATUS.BIRD;if(s.length<3&&i.length<3&&!o)return this.exchangeCell(e,t),this.cells[t.y][t.x].moveToAndBack(e),this.cells[e.y][e.x].moveToAndBack(t),this.lastPos=cc.p(-1,-1),[this.changeModels];this.lastPos=cc.p(-1,-1),this.cells[t.y][t.x].moveTo(t,this.curTime),this.cells[e.y][e.x].moveTo(e,this.curTime);var c=[t,e];return this.curTime+=d.ANITIME.TOUCH_MOVE,this.processCrush(c),[this.changeModels,this.effectsQueue]},c.prototype.processCrush=function(t){for(var e=0;0<t.length;){var s=[];if(0==e&&2==t.length){var i=t[0],o=t[1],c=this.cells[i.y][i.x],l=this.cells[o.y][o.x];if(c.status==d.CELL_STATUS.BIRD||l.status==d.CELL_STATUS.BIRD){c.status==d.CELL_STATUS.BIRD?(c.type=l.type,s.push(c)):(l.type=c.type,s.push(l))}}for(var n in t){var a=t[n];if(this.cells[a.y][a.x]){var r=this.checkPoint(a.x,a.y),h=r[0],u=r[1],p=r[2];if(!(h.length<3)){for(var f in h){var T=this.cells[h[f].y][h[f].x];this.crushCell(h[f].x,h[f].y),T.status!=d.CELL_STATUS.COMMON&&s.push(T)}this.createNewCell(a,u,p)}}}this.processBomb(s),this.curTime+=d.ANITIME.DIE,t=this.down(),e++}},c.prototype.createNewCell=function(t,e,s){if(""!=e){e==d.CELL_STATUS.BIRD&&(s=d.CELL_TYPE.BIRD);var i=new l.default;(this.cells[t.y][t.x]=i).init(s),i.setStartXY(t.x,t.y),i.setXY(t.x,t.y),i.setStatus(e),i.setVisible(0,!1),i.setVisible(this.curTime,!0),this.changeModels.push(i)}},c.prototype.down=function(){for(var t=[],e=1;e<=d.GRID_WIDTH;e++)for(var s=1;s<=d.GRID_HEIGHT;s++)if(null==this.cells[e][s]){for(var i=e,o=i;o<=d.GRID_HEIGHT;o++)this.cells[o][s]&&(this.pushToChangeModels(this.cells[o][s]),t.push(this.cells[o][s]),this.cells[i][s]=this.cells[o][s],this.cells[o][s]=null,this.cells[i][s].setXY(s,i),this.cells[i][s].moveTo(cc.p(s,i),this.curTime),i++);var c=1;for(o=i;o<=d.GRID_HEIGHT;o++)this.cells[o][s]=new l.default,this.cells[o][s].init(this.getRandomCellType()),this.cells[o][s].setStartXY(s,c+d.GRID_HEIGHT),this.cells[o][s].setXY(s,c+d.GRID_HEIGHT),this.cells[o][s].moveTo(cc.p(s,o),this.curTime),c++,this.changeModels.push(this.cells[o][s]),t.push(this.cells[o][s])}return this.curTime+=d.ANITIME.TOUCH_MOVE+.3,t},c.prototype.pushToChangeModels=function(t){-1==this.changeModels.indexOf(t)&&this.changeModels.push(t)},c.prototype.cleanCmd=function(){for(var t=1;t<=d.GRID_WIDTH;t++)for(var e=1;e<=d.GRID_HEIGHT;e++)this.cells[t][e]&&(this.cells[t][e].cmd=[])},c.prototype.exchangeCell=function(t,e){var s=this.cells[t.y][t.x];this.cells[t.y][t.x]=this.cells[e.y][e.x],this.cells[t.y][t.x].x=t.x,this.cells[t.y][t.x].y=t.y,this.cells[e.y][e.x]=s,this.cells[e.y][e.x].x=e.x,this.cells[e.y][e.x].y=e.y},c.prototype.setCellTypeNum=function(t){this.cellTypeNum=t,this.cellCreateType=[];for(var e=1;e<=t;e++)for(;;){var s=Math.floor(Math.random()*d.CELL_BASENUM)+1;if(-1==this.cellCreateType.indexOf(s)){this.cellCreateType.push(s);break}}},c.prototype.getRandomCellType=function(){var t=Math.floor(Math.random()*this.cellTypeNum);return this.cellCreateType[t]},c.prototype.processBomb=function(t){for(var e=this,s=function(){var u=[],p=d.ANITIME.BOMB_DELAY;t.forEach(function(t){if(t.status==d.CELL_STATUS.LINE){for(var e=1;e<=d.GRID_WIDTH;e++)this.cells[t.y][e]&&(this.cells[t.y][e].status!=d.CELL_STATUS.COMMON&&u.push(this.cells[t.y][e]),this.crushCell(e,t.y));this.addRowBomb(this.curTime,cc.p(t.x,t.y))}else if(t.status==d.CELL_STATUS.COLUMN){for(var s=1;s<=d.GRID_HEIGHT;s++)this.cells[s][t.x]&&(this.cells[s][t.x].status!=d.CELL_STATUS.COMMON&&u.push(this.cells[s][t.x]),this.crushCell(t.x,s));this.addColBomb(this.curTime,cc.p(t.x,t.y))}else if(t.status==d.CELL_STATUS.WRAP)for(var i=t.x,o=t.y,c=1;c<=d.GRID_HEIGHT;c++)for(var l=1;l<=d.GRID_WIDTH;l++){var n=Math.abs(i-l)+Math.abs(o-c);this.cells[c][l]&&n<=2&&(this.cells[c][l].status!=d.CELL_STATUS.COMMON&&u.push(this.cells[c][l]),this.crushCell(l,c))}else if(t.status==d.CELL_STATUS.BIRD){var a=t.type;p<d.ANITIME.BOMB_BIRD_DELAY&&(p=d.ANITIME.BOMB_BIRD_DELAY),a==d.CELL_TYPE.BIRD&&(a=this.getRandomCellType());for(var r=1;r<=d.GRID_HEIGHT;r++)for(var h=1;h<=d.GRID_WIDTH;h++)this.cells[r][h]&&this.cells[r][h].type==a&&(this.cells[r][h].status!=d.CELL_STATUS.COMMON&&u.push(this.cells[r][h]),this.crushCell(h,r,!0))}},e),0<t.length&&(e.curTime+=p),t=u};0<t.length;)s()},c.prototype.addCrushEffect=function(t,e){this.effectsQueue.push({playTime:t,pos:e,action:"crush"})},c.prototype.addRowBomb=function(t,e){this.effectsQueue.push({playTime:t,pos:e,action:"rowBomb"})},c.prototype.addColBomb=function(t,e){this.effectsQueue.push({playTime:t,pos:e,action:"colBomb"})},c.prototype.addWrapBomb=function(t,e){};var n=0;c.prototype.crushCell=function(t,e,s){var i=this.cells[e][t];this.pushToChangeModels(i),s?(i.toShake(this.curTime),i.toDie(this.curTime+d.ANITIME.DIE_SHAKE)):i.toDie(this.curTime),this.addCrushEffect(this.curTime,cc.p(i.x,i.y)),this.cells[e][t]=null,n+=1},c.prototype.setScore=function(){var t=100*n;return 25e3<=t&&(cc.director.loadScene("End"),n=0),t},e.exports=s.default,cc._RF.pop()},{"./CellModel":"CellModel","./ConstValue":"ConstValue",GameController:"GameController"}],GridView:[function(t,e,s){"use strict";cc._RF.push(e,"d0d1fDj9rlDx5QUtP+2toQV","GridView");var c=t("../Model/ConstValue");cc.Class({extends:cc.Component,properties:{aniPre:{default:[],type:[cc.Prefab]},effectLayer:{default:null,type:cc.Node}},onLoad:function(){this.setListener(),this.lastTouchPos=cc.Vec2(-1,-1),this.isCanMove=!0,this.isInPlayAni=!1},setController:function(t){this.controller=t},initWithCellModels:function(t){this.cellViews=[];for(var e=1;e<=c.GRID_WIDTH;e++){this.cellViews[e]=[];for(var s=1;s<=c.GRID_HEIGHT;s++){var i=t[e][s].type,o=cc.instantiate(this.aniPre[i]);o.parent=this.node,o.getComponent("CellView").initWithModel(t[e][s]),this.cellViews[e][s]=o}}},setListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(t){if(this.isInPlayAni)return!0;var e=t.getLocation(),s=this.convertTouchPosToCell(e);s?3<=this.selectCell(s).length?this.isCanMove=!1:this.isCanMove=!0:this.isCanMove=!1;return!0},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(this.isCanMove){var e=t.getStartLocation(),s=this.convertTouchPosToCell(e),i=t.getLocation(),o=this.convertTouchPosToCell(i);if(s.x!=o.x||s.y!=o.y){this.isCanMove=!1;this.selectCell(o)}}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(t){},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(t){},this)},convertTouchPosToCell:function(t){if((t=this.node.convertToNodeSpace(t)).x<0||t.x>=c.GRID_PIXEL_WIDTH||t.y<0||t.y>=c.GRID_PIXEL_HEIGHT)return!1;var e=Math.floor(t.x/c.CELL_WIDTH)+1,s=Math.floor(t.y/c.CELL_HEIGHT)+1;return cc.p(e,s)},updateView:function(t){var e=[];for(var s in t){var i=t[s],o=this.findViewByModel(i),c=null;if(o)c=o.view,this.cellViews[o.y][o.x]=null;else{var l=i.type,n=cc.instantiate(this.aniPre[l]);n.parent=this.node,n.getComponent("CellView").initWithModel(i),c=n}c.getComponent("CellView").updateView(),i.isDeath||e.push({model:i,view:c})}e.forEach(function(t){var e=t.model;this.cellViews[e.y][e.x]=t.view},this)},updateSelect:function(t){for(var e=1;e<=c.GRID_WIDTH;e++)for(var s=1;s<=c.GRID_HEIGHT;s++)if(this.cellViews[e][s]){var i=this.cellViews[e][s].getComponent("CellView");t.x==s&&t.y==e?i.setSelect(!0):i.setSelect(!1)}},findViewByModel:function(t){for(var e=1;e<=c.GRID_WIDTH;e++)for(var s=1;s<=c.GRID_HEIGHT;s++)if(this.cellViews[e][s]&&this.cellViews[e][s].getComponent("CellView").model==t)return{view:this.cellViews[e][s],x:s,y:e};return null},getPlayAniTime:function(t){if(!t)return 0;var e=0;return t.forEach(function(t){t.cmd.forEach(function(t){e<t.playTime+t.keepTime&&(e=t.playTime+t.keepTime)},this)},this),e},disableTouch:function(t){t<=0||(this.isInPlayAni=!0,this.node.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){this.isInPlayAni=!1},this))))},selectCell:function(t){var e=this.controller.selectCell(t),s=e[0],i=e[1];return this.playEffect(i),this.disableTouch(this.getPlayAniTime(s)),this.updateView(s),this.controller.cleanCmd(),2<=s.length?this.updateSelect(cc.p(-1,-1)):this.updateSelect(t),s},playEffect:function(t){this.effectLayer.getComponent("EffectLayer").playEffects(t)}}),cc._RF.pop()},{"../Model/ConstValue":"ConstValue"}],StartScene:[function(t,e,s){"use strict";cc._RF.push(e,"f19c7QnNU9A4YO+7XKmlejD","StartScene"),cc.Class({extends:cc.Component,properties:{Strat_btn:{default:null,type:cc.Node}},onLoad:function(){cc.director.preloadScene("Game"),this.Strat_btn.on("touchstart",function(){cc.director.loadScene("Game")})},start:function(){}}),cc._RF.pop()},{}]},{},["GameController","EndScene","CellModel","ConstValue","GameModel","StartScene","CellView","EffectLayer","GridView"]);